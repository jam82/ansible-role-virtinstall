#!/usr/bin/env bash
# file: {{ template_destpath }}
# vim: ft=bash

virt-install \
{% if virtinstall_autostart is defined and virtinstall_autostart | bool %}
    --autostart \
{% endif %}
{% if virtinstall_boot | default([]) | length > 0 %}
    --boot {{ virtinstall_boot | join(',') | default(omit) }} \
{% endif %}
{% if virtinstall_connection | default('') | length > 0 %}
    --connect {{ virtinstall_connection | default('qemu:///system') }} \
{% endif %}
{% if virtinstall_console | default('') | length > 0 %}
    --console {{ virtinstall_console | default(omit) }} \
{% endif %}
{% if virtinstall_cpu | default(2) %}
    --cpu {{ virtinstall_cpu | default(omit) }} \
{% endif %}
{% if virtinstall_cpuset | default('') | length > 0 %}
    --cpuset {{ virtinstall_cpuset | default(omit) }} \
{% endif %}
{% for disk in virtinstall_disks %}
    --disk {{ disk | default('pool=default,size=8') }} \
{% endfor %}
{% if virtinstall_extra_args | default([]) | length > 0 %}
    --extra-args "{{ virtinstall_extra_args | join(' ') | default(omit) }}" \
{% endif %}
{% if virtinstall_features | default([]) | length > 0 %}
    --features "{{ virtinstall_features | join(',') | default(omit) }}" \
{% endif %}
{% for card in virtinstall_graphics %}
    --graphics {{ card | default('none') }} \
{% endfor %}
{% if virtinstall_initrd_inject | default('') | length > 0 %}
    --initrd-inject {{ virtinstall_initrd_inject | default(omit) }} \
{% endif %}
{% if virtinstall_location | default('') | length > 0 %}
    --location {{ virtinstall_location | default(omit) }} \
{% endif %}
    --memory {{ virtinstall_memory | default(2048) }} \
    --name {{ virtinstall_name }} \
{% if _vm.macs | default([]) | length > 0 %}
{% for mac in _vm.macs %}
    --network={{ virtinstall_networks[loop.index0] }},mac={{ mac }} \
{% endfor %}
{% else %}
{% for net in virtinstall_networks %}
    --network={{ net }}
{% endfor %}
{% endif %}
{% if virtinstall_noautoconsole | default('noautoconsole') %}
    --{{ virtinstall_noautoconsole | ternary('noautoconsole','autoconsole') }} \
{% endif %}
    --os-variant={{ virtinstall_os_variant | default(generic) }} \
{% if virtinstall_pxe is defined and virtinstall_pxe | bool %}
    --pxe \
{% endif %}
{% if virtinstall_reinstall | default(false) %}
    --reinstall {{ virtinstall_name }} \
{% endif %}
    --sound {{ virtinstall_sound | default(none) }} \
    --vcpus={{ virtinstall_vcpus | default(2) }} \
    --virt-type {{ virtinstall_virt_type | default(kvm) }}
